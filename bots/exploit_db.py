# -*- coding: utf-8 -*-

from model.result import Result
from bots.bot_base import Base
import re


class ExploitDB(Base):
    def __init__(self):
        Base.__init__(self)

    def bot_search(self):
        self.results = []
        for i in range(5):
            url = "http://www.exploit-db.com/search/"
            parameters = {"action": "search", 
                          "filter_page": "{0}".format(i),
                          "filter_description": "{0}".format(self.filter_description)}
            try:
                pagehtml = self.object_download.get_download_page(url, parameters)
                if (pagehtml):
                    self.extract_data(pagehtml)
            except Exception, ex:
                pass
        return self.results

    def extract_data(self, html):
        html = re.sub(r"\n", " ", html)
        html = re.sub(r"\"", "'", html)
        r = re.compile(r"<tr.*?"
                       "class='list_explot_date'>(?P<Date>[^<]*?)<.*?class='list_explot_dlink'>.*?"
                       "<a href='(?P<Download>[^']*?)'.*?class='list_explot_description'>.*?"
                       "<a href='(?P<Link>[^']*?)'>(?P<Description>[^<]*?)<.*?"
                       "class='list_explot_author'>.*?"
                       "title='(?P<Author>[^']*?)'.*?"
                       "</tr>")
        for match in r.finditer(html):
            if match:
                self.results.append(match.groupdict())